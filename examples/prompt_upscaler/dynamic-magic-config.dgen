#! /usr/bin/env dgenerate --file
#! dgenerate 4.5.1

# prompt upscaler plugins can preprocess and expand prompts, allowing
# for LLM based txt2txt enhancement or prompt expansion resulting
# in additional prompt variations being produced

# prompt upscalers can be specified using prompt embedded arguments or with the --prompt-upscaler
# argument, and related arguments of dgenerate

# --prompt-upscaler will set the prompt upscaler for all prompts globally, you can further
# fine tune which prompts are affected by using the various --prompt-upscaler options
# of dgenerate related to secondary and tertiary prompts etc. or by narrowing it down
# to a single prompt by using prompt embedded argument syntax in the affected prompt

# below we use the embedded argument syntax to specify the dynamicprompts upscaler
# which is capable of producing prompt variations in a combinatorial or random fashion
# depending on configuration, as well as the magicprompt upscaler which can enhance
# prompts using an LLM, then we use the attention upscaler to add random attention
# values to the prompt tokens

# multiple prompt upscalers can be specified if you desire, their results will be chained
# together sequentially, this will be handled correctly even if the prompt upscaler
# returns multiple prompts via expansion


# this example uses the dynamicprompts plugin,
# the magicprompt plugin, and the attention plugin

\prompt_upscaler_help dynamicprompts magicprompt attention


# 2 variants of a combinatorial prompt will be generated using dynamicprompts

# then each prompt will be upscaled using a ChatGPT-2 finetune
# that is the default for the magicprompt plugin: "Gustavosta/MagicPrompt-Stable-Diffusion",
# the 2 prompts will be upscaled by the LLM as variations with different text, as
# the seed argument of magicprompt has not been set

# then the attention upscaler will add random attention values to the resulting prompts

stabilityai/stable-diffusion-xl-base-1.0
--model-type torch-sdxl
--dtype float16
--variant fp16
--inference-steps 30
--guidance-scales 5
--clip-skips 0
--gen-seeds 1
--output-path output
--output-size 1024x1024
--prompt-weighter sd-embed
--prompts "<upscaler: dynamicprompts> <upscaler: magicprompt> <upscaler: dynamicprompts> <upscaler: attention> a large {horse|dog} in a field, cloudy day"